<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Sentinel migration from MMA to AMA"><title>Migration from MMA to AMA and DCR configuration + Azure Policy</title><link rel=canonical href=https://robertodandrea.com/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Migration from MMA to AMA and DCR configuration + Azure Policy"><meta property='og:description' content="Sentinel migration from MMA to AMA"><meta property='og:url' content='https://robertodandrea.com/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/'><meta property='og:site_name' content="Roberto D'Andrea"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Microsoft'><meta property='article:tag' content='Sentinel'><meta property='article:tag' content='Configuration'><meta property='article:published_time' content='2025-03-06T00:00:00+00:00'><meta property='article:modified_time' content='2025-03-06T00:00:00+00:00'><meta name=twitter:title content="Migration from MMA to AMA and DCR configuration + Azure Policy"><meta name=twitter:description content="Sentinel migration from MMA to AMA"><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-FDDB8HCY82"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FDDB8HCY82")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_72b05344e1ff7836.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>⚙️</span></figure><div class=site-meta><h1 class=site-name><a href=/>Roberto D'Andrea</a></h1><h2 class=site-description>Cloud Security Engineer @CoreView</h2></div></header><ol class=menu-social><li><a href='mailto:dandrea.ingegnereinformatico@gmail.com?body=Hi%20Roberto%2C' target=_blank title=Email rel=me><!doctype html><svg enable-background="new 0 0 32 32" height="32" viewBox="0 0 32 32" width="32" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Gmail"><path d="M27 27c-.276.0-.5-.224-.5-.5v-13c0-.276.224-.5.5-.5s.5.224.5.5v13c0 .276-.224.5-.5.5z" fill="#263238"/><path d="M5 27c-.276.0-.5-.224-.5-.5v-13c0-.276.224-.5.5-.5s.5.224.5.5v13c0 .276-.224.5-.5.5z" fill="#263238"/><g><path d="M16 14.432c-.099.0-.197-.029-.282-.087L3.553 6.021c-.228-.156-.286-.467-.13-.695.156-.228.466-.287.695-.13L16 13.326l8.958-6.129c.229-.156.54-.097.695.13.156.228.098.539-.13.695l-9.24 6.322C16.197 14.403 16.099 14.432 16 14.432z" fill="#263238"/></g><g><path d="M28.5 27h-25C2.122 27 1 25.878 1 24.5v-17c0-.276.224-.5.5-.5s.5.224.5.5v17C2 25.327 2.673 26 3.5 26h25c.827.0 1.5-.673 1.5-1.5v-17C30 6.673 29.327 6 28.5 6c-.276.0-.5-.224-.5-.5s.224-.5.5-.5C29.878 5 31 6.122 31 7.5v17c0 1.378-1.122 2.5-2.5 2.5z" fill="#263238"/></g><g><path d="M16 19c-.099.0-.198-.029-.284-.088L2.066 9.498C1.398 9.038 1 8.278 1 7.467 1 6.107 2.107 5 3.467 5h25.065C29.893 5 31 6.107 31 7.467c0 .811-.398 1.57-1.066 2.031l-13.65 9.414C16.198 18.971 16.099 19 16 19zM3.467 6C2.658 6 2 6.658 2 7.467 2 7.95 2.237 8.401 2.634 8.675L16 17.893l13.366-9.218C29.763 8.401 30 7.95 30 7.467 30 6.658 29.342 6 28.533 6H3.467z" fill="#263238"/></g></g></svg></a></li><li><a href=https://github.com/r-dandrea target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://t.me/Roberto_D_Andrea target=_blank title=Telegram rel=me><!doctype html><svg height="512" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="512" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x33_35-telegram"><g><g><path d="M484.689 98.231l-69.417 327.37c-5.237 23.105-18.895 28.854-38.304 17.972L271.2 365.631l-51.034 49.086c-5.646 5.647-10.371 10.372-21.256 10.372l7.598-107.722L402.539 140.23c8.523-7.598-1.848-11.809-13.247-4.21L146.95 288.614 42.619 255.96c-22.694-7.086-23.104-22.695 4.723-33.579L455.423 65.166C474.316 58.081 490.85 69.375 484.689 98.231z" style="fill:#20a0e1"/></g></g></g><g id="Layer_1"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/whoami/><!doctype html><svg enable-background="new 0 0 48 48" height="48" id="Layer_1" viewBox="0 0 48 48" width="48" xmlns:xlink="http://www.w3.org/1999/xlink"><path clip-rule="evenodd" d="M35 47H13c-2.209.0-4-1.791-4-4V13c0-2.209 1.791-4 4-4h7V5c0-2.209 1.791-4 4-4s4 1.791 4 4v4h7c2.209.0 4 1.791 4 4v30c0 2.209-1.791 4-4 4zM26 5c0-1.104-.896-2-2-2s-2 .896-2 2v6c0 1.104.896 2 2 2s2-.896 2-2V5zm11 8c0-1.104-.896-2-2-2h-7c0 2.209-1.791 4-4 4s-4-1.791-4-4h-7c-1.104.0-2 .896-2 2v24h3.797c.231-.589.656-1.549 1.16-2.24.025-.014.848-1.739 4.998-1.79.006-.021.01-1.042.022-1.027-.32-.202-.737-.516-1.051-.816-.255-.156-1.161-1.029-1.452-2.583-.087-.542-.488-3.099-.488-4.166.0-3.171 1.265-6.381 5.953-6.381.021.0.1.0.121.0 4.688.0 5.953 3.21 5.953 6.381.0 1.067-.401 3.624-.488 4.166-.291 1.554-1.196 2.427-1.452 2.583-.313.301-.73.614-1.051.816.013-.015.018 1.007.022 1.027 4.151.051 4.974 1.776 4.998 1.79.504.691.929 1.651 1.16 2.24H37V13zM25.014 31.488c-.001.003-.001.004-.001.004-.003.0-.017-.781-.017-.781s1.166-.601 2.031-1.378c.507-.417.741-1.362.741-1.362.137-.828.238-2.877.238-3.703.0-2.062-1.033-4.28-4.007-4.28.0.0.0-.006.0-.007v.007c-2.974.0-4.007 2.219-4.007 4.28.0.826.103 2.875.238 3.703.0.0.234.945.741 1.362.865.777 2.031 1.378 2.031 1.378s-.014.781-.018.781c0 0 0-.001.0-.004.0.0.029 1.146.029 1.486.0 1.363-1.365 2.019-2.223 2.019-.002.0-.002.0-.003.0-2.593.114-3.205.976-3.21.984C17.419 36.23 17.2 36.482 16.998 37h14.005c-.203-.518-.422-.77-.582-1.022-.006-.009-.619-.87-3.211-.984-.001.0-.001.0-.002.0-.858.0-2.224-.655-2.224-2.019C24.984 32.634 25.014 31.488 25.014 31.488zM37 39H11v4c0 1.104.896 2 2 2h22c1.104.0 2-.896 2-2V39zm-6 4h-3c-.553.0-1-.447-1-1s.447-1 1-1h3c.553.0 1 .447 1 1S31.553 43 31 43zm-8 0h-6c-.553.0-1-.447-1-1s.447-1 1-1h6c.553.0 1 .447 1 1S23.553 43 23 43zM23 5h2v2h-2V5z" fill-rule="evenodd"/></svg>
<span>whoami</span></a></li><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Post</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#1-ama-migration-workbook>1. AMA Migration Workbook</a></li><li><a href=#2-agent-installation---creation-of-dcr-windows>2. Agent Installation - Creation of DCR (Windows)</a></li><li><a href=#3-azure-policy>3. Azure Policy</a></li><li><a href=#conclusion>Conclusion</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/sentinel/>Sentinel</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/>Migration from MMA to AMA and DCR configuration + Azure Policy</a></h2><h3 class=article-subtitle>Sentinel migration from MMA to AMA</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 06, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>8 minute read</time></div></footer></div></header><section class=article-content><h1 id=migration-from-mma-to-ama-and-dcr-configuration--azure-policy>Migration from MMA to AMA and DCR configuration + Azure Policy</h1><p>Microsoft has announced the deprecation of the <strong>Microsoft Monitoring Agent</strong> (MMA), effective August 31. If you&rsquo;re still using MMA to collect and manage your monitoring data, now is the time to plan your transition to <strong>Azure Monitor Agent</strong> (AMA).</p><div style="background:#fffbe5;border-left:7px solid #e9c46a;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>⚠️ Warning</strong><div style=margin-top:6px><p>The <strong>MMA</strong> will officially be deprecated on <strong>August 31</strong>. Although MMA will continue to be active for logging purposes until 1 of February, it’s important to note that Microsoft will not provide support for any issues encountered after August 31.</p><p>Therefore, to ensure uninterrupted support and to take advantage of the latest features, you should complete your migration to AMA before the deprecation date.</p></div><style>@media(prefers-color-scheme:dark){div[style*='background: #fffbe5']{background:#322911!important;color:#f3e7be!important;border-left:7px solid #e9c46a!important}div[style*='background: #fffbe5'] strong{color:#ffe066!important}}</style></div><p>The Azure Monitor Agent represents a significant advancement in monitoring capabilities, offering enhanced performance, security, and flexibility. Microsoft recommends migrating to AMA to take advantage of these improvements and ensure continued support for your monitoring needs.</p><p>In this post, we’ll guide you through the migration process by showing you how to configure and install the new Azure Monitor Agent, set up <strong>Data Collection Rules</strong> (DCR), and apply Azure policies to automate the deployment of both the AMA agent and DCR. This step-by-step guide will ensure a seamless transition and help you leverage the latest monitoring technology efficiently.</p><p><strong>Content</strong></p><ol><li>AMA Migration Workbook</li><li>Agent Installation - Creation of DCR</li><li>Azure Policy</li><li>Conclusion</li></ol><h3 id=1-ama-migration-workbook>1. AMA Migration Workbook</h3><p>To get a comprehensive view of all the VMs, Azure Arc resources, and VMSS that need to be migrated to the new Azure Monitor Agent (AMA), you can use this workbook.</p><p>Navigate over Monitor Service on Azure → Workbooks → AMA Migration Helper</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAMigrationHelper-Workbook.png width=1046 height=714 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAMigrationHelper-Workbook_hu_5f96a3c9fdf71ff.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAMigrationHelper-Workbook_hu_d09959ab620cabdd.png 1024w" loading=lazy alt="AMA Migration Helper - Workbook" class=gallery-image data-flex-grow=146 data-flex-basis=351px></p><p>Here you can find the migration status, with all the machines to be migrated categorized by different resource types. The workbook highlights:</p><ul><li><span style=color:blue><strong>In blue:</strong></span> Agents with both agents.</li><li><span style=color:red><strong>In red:</strong></span> Agents with only MMA/OMS.</li><li><span style=color:green><strong>In green:</strong></span> Agents with only AMA.</li></ul><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAMigrationHelper-Workbook2.png width=1898 height=857 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAMigrationHelper-Workbook2_hu_7eb0071b56ffed02.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAMigrationHelper-Workbook2_hu_b77ae6a5106bba5f.png 1024w" loading=lazy alt="AMA Migration Helper - Workbook" class=gallery-image data-flex-grow=221 data-flex-basis=531px></p><p>Within each tab, you can also see detailed status updates for agent installations on each VM, Azure ARC or VMSS highlighting the specific installation status.</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AzureVirtualMachine.png width=1633 height=470 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AzureVirtualMachine_hu_8f00c0552ecbd6e9.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AzureVirtualMachine_hu_c0490304fe381526.png 1024w" loading=lazy alt="Azure Virtual Machine" class=gallery-image data-flex-grow=347 data-flex-basis=833px></p><div style="background:#fff;border-left:7px solid #d1d5db;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>💡</strong><div style=margin-top:6px>This workbook can be very useful as it provides detailed insights into the agent installations allowing you to view each installation in detail.</div><style>div[style*='border-left: 7px'][style*=background] a{color:#2563eb!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#1d4ed8!important}@media(prefers-color-scheme:dark){div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db']{background:#232323!important;color:#eee!important;border-left:7px solid #6b7280!important}div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db'] strong{color:#eee!important}div[style*='border-left: 7px'][style*=background] a{color:#86b7fd!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#f9fafb!important}}</style></div><h3 id=2-agent-installation---creation-of-dcr-windows>2. Agent Installation - Creation of DCR (Windows)</h3><div style="background:#fffbe5;border-left:7px solid #e9c46a;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>⚠️ Warning</strong><div style=margin-top:6px>You need to create the DCR from Sentinel Connector</div><style>@media(prefers-color-scheme:dark){div[style*='background: #fffbe5']{background:#322911!important;color:#f3e7be!important;border-left:7px solid #e9c46a!important}div[style*='background: #fffbe5'] strong{color:#ffe066!important}}</style></div><p><em>Naviga su Sentinel → Data Connector → Windows Security Events via AMA</em></p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAConnector.png width=914 height=161 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAConnector_hu_3350083b759b266d.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAConnector_hu_da4174c65eba2296.png 1024w" loading=lazy alt="AMA Connector (Windows & Mac)" class=gallery-image data-flex-grow=567 data-flex-basis=1362px></p><p>Open connector page</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/WindowsAMAConnector.png width=438 height=705 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/WindowsAMAConnector_hu_741b0fc37ea528d6.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/WindowsAMAConnector_hu_f0f1ad3c11337e8a.png 1024w" loading=lazy alt="Windows AMA Connector" class=gallery-image data-flex-grow=62 data-flex-basis=149px></p><p>Here tou can create your DCR</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRCreation.png width=742 height=503 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRCreation_hu_34e1cf042199d871.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRCreation_hu_a69feaa9e4edae69.png 1024w" loading=lazy alt="Data Collection Rule creation" class=gallery-image data-flex-grow=147 data-flex-basis=354px></p><div style="background:#fff;border-left:7px solid #d1d5db;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>💡</strong><div style=margin-top:6px>What I recommend is creating separate Data Collection Rules for each type of host, such as Windows and Linux (use Syslog via AMA), and also <strong>dividing the DCRs for other groups of machines</strong>. This approach ensures that you have DCRs with specific events tailored to different types of hosts</div><style>div[style*='border-left: 7px'][style*=background] a{color:#2563eb!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#1d4ed8!important}@media(prefers-color-scheme:dark){div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db']{background:#232323!important;color:#eee!important;border-left:7px solid #6b7280!important}div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db'] strong{color:#eee!important}div[style*='border-left: 7px'][style*=background] a{color:#86b7fd!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#f9fafb!important}}</style></div><p>Define Name for the DCR and Resource Group where is stored (default will be Sentinel)</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRName.png width=799 height=337 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRName_hu_9a8f24fe159d046d.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRName_hu_fd8659eda35ca65.png 1024w" loading=lazy alt="DCR Name" class=gallery-image data-flex-grow=237 data-flex-basis=569px></p><p>In the Resources tab select all the VM and Azure Arc that you want to monitoring.</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRResource.png width=793 height=522 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRResource_hu_90371a52a5d08a75.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRResource_hu_ac593d1b22071ecc.png 1024w" loading=lazy alt="DCR Resource" class=gallery-image data-flex-grow=151 data-flex-basis=364px></p><p>After all you need to select with kind of event you want to store.</p><div style="background:#fff;border-left:7px solid #d1d5db;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>💡</strong><div style=margin-top:6px><p>To better understand what to ingest, here you can find <strong>guides</strong> that describe in detail what each tab represents.</p><ul><li><strong>Windows</strong> → <a class=link href=https://learn.microsoft.com/en-us/azure/sentinel/windows-security-event-id-reference target=_blank rel=noopener>Windows Security Event Reference</a></li><li><strong>Linux</strong> → <a class=link href=https://learn.microsoft.com/en-us/azure/azure-monitor/agents/data-sources-syslog#configure-syslog-in-the-azure-portal target=_blank rel=noopener>Configure Syslog in Azure portal</a></li><li><strong>Deep Dive on Linux event</strong> → <a class=link href=https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/deep-dive-how-to-debug-syslog-ingestion-for-sentinel-and-log/ba-p/2007056 target=_blank rel=noopener>How to debug Syslog ingestion</a></li></ul></div><style>div[style*='border-left: 7px'][style*=background] a{color:#2563eb!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#1d4ed8!important}@media(prefers-color-scheme:dark){div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db']{background:#232323!important;color:#eee!important;border-left:7px solid #6b7280!important}div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db'] strong{color:#eee!important}div[style*='border-left: 7px'][style*=background] a{color:#86b7fd!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#f9fafb!important}}</style></div><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRCollect.png width=414 height=192 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRCollect_hu_e8894c717defd127.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DCRCollect_hu_5b80fa7c6a127487.png 1024w" loading=lazy alt="DCR Collect" class=gallery-image data-flex-grow=215 data-flex-basis=517px></p><p>After all click on Create and wait the creation of DCR and the deploy of AMA over VM and Azure ARC.</p><ul><li>Evidence of DCR created over DCR services</li></ul><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DataCollectionRuleEvidence.png width=1818 height=452 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DataCollectionRuleEvidence_hu_a63b011b19f0d0a7.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/DataCollectionRuleEvidence_hu_3be2cfd7ea561a51.png 1024w" loading=lazy alt="Data Collection Rule Evidence" class=gallery-image data-flex-grow=402 data-flex-basis=965px></p><ul><li>Evidence of AMA installation on VM</li></ul><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAAgentOnVM.png width=1902 height=647 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAAgentOnVM_hu_78976f2c155690f0.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAAgentOnVM_hu_9401de53f50c8727.png 1024w" loading=lazy alt="Navigate over VM → Extensions + application " class=gallery-image data-flex-grow=293 data-flex-basis=705px></p><div style="background:#fff5f5;border-left:7px solid #ef4444;padding:1em;margin:1em 0;border-radius:6px;color:#991b1b"><strong>🚨 Alert</strong><div style=margin-top:6px><strong>Remember to unistall the MMA agent</strong>, as having it active could result in duplicate events within your workspace.
<img src=/images/UnistallAMAAgent.png loading=lazy alt="Unistall AMA Agent"></div><style>@media(prefers-color-scheme:dark){div[style*='background: #fff5f5']{background:#2b1818!important;color:#fff5f5!important;border-left:7px solid #fb7185!important}div[style*='background: #fff5f5'] strong{color:#fde0e0!important}div[style*='background: #fff5f5'] img{border:1px solid #fb7185!important;border-radius:8px;margin-top:10px;margin-bottom:4px;max-width:100%}}div[style*='background: #fff5f5'] img{border:1px solid #ef4444;border-radius:8px;margin-top:10px;margin-bottom:4px;max-width:100%}</style></div><h3 id=3-azure-policy>3. Azure Policy</h3><p>Azure Policy can be used to deploy the Azure Monitor Agent. To achieve this, follow these steps:</p><ol><li><strong>Navigate to the Azure Policy Section:</strong> Access the Azure portal and go to the &ldquo;Policy&rdquo; section from the left-hand menu.</li><li><strong>Create a New Policy:</strong> In the Azure Policy dashboard, select &ldquo;Create Policy&rdquo; to start the process of defining a new policy.</li><li><strong>Configure the Policy:</strong> Set up the policy parameters to deploy the Azure Monitor Agent. You can specify the conditions under which the agent should be installed and apply it to the appropriate scope, such as specific resource groups or subscriptions.</li><li><strong>Assign the Policy:</strong> Once configured, assign the policy to the desired resources. This will ensure that the Azure Monitor Agent is automatically installed on all resources that meet the policy criteria.</li></ol><div style="background:#fff;border-left:7px solid #d1d5db;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>💡</strong><div style=margin-top:6px>Here you can find <strong>guides</strong> that describe in detail the Azure Policy.
There are built-in policy initiatives for Windows and Linux virtual machines <a class=link href=https://learn.microsoft.com/en-us/azure/azure-monitor/agents/azure-monitor-agent-policy#built-in-policy-initiatives target=_blank rel=noopener>Azure Policy</a></div><style>div[style*='border-left: 7px'][style*=background] a{color:#2563eb!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#1d4ed8!important}@media(prefers-color-scheme:dark){div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db']{background:#232323!important;color:#eee!important;border-left:7px solid #6b7280!important}div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db'] strong{color:#eee!important}div[style*='border-left: 7px'][style*=background] a{color:#86b7fd!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#f9fafb!important}}</style></div><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/BuiltinPolicy.png width=846 height=372 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/BuiltinPolicy_hu_3ebeacc5e995858d.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/BuiltinPolicy_hu_fd8f857d4066aeba.png 1024w" loading=lazy alt="Built-in Policy" class=gallery-image data-flex-grow=227 data-flex-basis=545px></p><p>Within these two rules, I recommend selecting exclusively the following two policies that are essential for installing the Azure Monitor Agent (AMA) and assigning the Data Collection Rule (DCR) to the VM:</p><ol><li><p><strong>Policy for Installing the Azure Monitor Agent (AMA):</strong> This policy ensures that the AMA is automatically deployed on the targeted virtual machines. It simplifies the installation process by applying the agent configuration across your environment.</p></li><li><p><strong>Policy for Assigning Data Collection Rules (DCRs):</strong> This policy is responsible for applying the appropriate DCR to each VM. It guarantees that the data collection settings are consistently applied, enabling accurate and comprehensive monitoring.</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy.png width=1788 height=545 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy_hu_b5f7bf215da0586e.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy_hu_ad500edcb23701b2.png 1024w" loading=lazy alt=Policy class=gallery-image data-flex-grow=328 data-flex-basis=787px></p></li><li><p><strong>Policy for Installing the Azure Monitor Agent (AMA)</strong>
<img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAPolicy.png width=1755 height=536 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAPolicy_hu_3cc2a8d9fc2c4bfb.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AMAPolicy_hu_2ba8a11c4b4f5f17.png 1024w" loading=lazy alt="AMA Policy" class=gallery-image data-flex-grow=327 data-flex-basis=785px></p></li></ol><p>Starting for the first one click on <em>Configure Windows virtual machines to run Azure Monitor Agent with user-assigned managed identity-based authentication</em> and click on Assign</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AssignPolicy.png width=1880 height=642 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AssignPolicy_hu_54caf177fbea1b49.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/AssignPolicy_hu_f70b85838a03adde.png 1024w" loading=lazy alt="Assign Policy" class=gallery-image data-flex-grow=292 data-flex-basis=702px></p><p>Here you need to select the Scope where the Policy will be executed.</p><p>For example you can also select all Subscption or even specific Resource Group.</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Scope.png width=1911 height=651 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Scope_hu_5d416883408b3859.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Scope_hu_b42b0b996bd499c1.png 1024w" loading=lazy class=gallery-image data-flex-grow=293 data-flex-basis=704px></p><div style="background:#fff;border-left:7px solid #d1d5db;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>💡</strong><div style=margin-top:6px>You can also build an Exclusions path to ensure that you do not unintentionally apply the policy you are creating.</div><style>div[style*='border-left: 7px'][style*=background] a{color:#2563eb!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#1d4ed8!important}@media(prefers-color-scheme:dark){div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db']{background:#232323!important;color:#eee!important;border-left:7px solid #6b7280!important}div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db'] strong{color:#eee!important}div[style*='border-left: 7px'][style*=background] a{color:#86b7fd!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#f9fafb!important}}</style></div><p>Skip the Advances step</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy2.png width=1332 height=647 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy2_hu_3bc069688bb548d9.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy2_hu_8a35f69c275a48a7.png 1024w" loading=lazy class=gallery-image data-flex-grow=205 data-flex-basis=494px></p><p>On Parameters step set Bring Your Own User-Assigned Managed Identity as True</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy3.png width=1362 height=363 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy3_hu_10d5b0da8e11d18e.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy3_hu_efb4e1cd7e654dee.png 1024w" loading=lazy class=gallery-image data-flex-grow=375 data-flex-basis=900px></p><p>In the Remediation tab, enter a <strong>user-assigned managed identity</strong> and check the box for &ldquo;Create Remediation Task.&rdquo; This will ensure that the policy uses the specified identity and sets up a remediation task if needed.</p><div style="background:#fff;border-left:7px solid #d1d5db;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>💡</strong><div style=margin-top:6px><p>Create <strong>user-assigned managed identity</strong> in order to have a identity that have the correct permission to install AMA and also assign the DCR.</p><p><strong>Required permissions:</strong> <a class=link href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/data-collection-rule-create-edit?tabs=portal#permissions" target=_blank rel=noopener>Create and Edit DCR</a></p><p>Navigate over Managed Identities and click on Create</p><p><img src=/images/ManagedIdentity.png loading=lazy alt="Managed Identity Setup"></p><p>After creating it, remember to add the required permissions in the Azure Role Assignments section.</p><p><img src=/images/RoleDefinition.png loading=lazy alt="Role definition"></p><p><em>Role example (here I add owner just for a test)</em></p><p><img src=/images/RoleMI.png loading=lazy></p></div><style>div[style*='border-left: 7px'][style*=background] a{color:#2563eb!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#1d4ed8!important}@media(prefers-color-scheme:dark){div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db']{background:#232323!important;color:#eee!important;border-left:7px solid #6b7280!important}div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db'] strong{color:#eee!important}div[style*='border-left: 7px'][style*=background] a{color:#86b7fd!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#f9fafb!important}}</style></div><div style="background:#fffbe5;border-left:7px solid #e9c46a;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>⚠️ Warning</strong><div style=margin-top:6px>Remember that adding the Remediation tab allows the policy to be applied to existing VMs as well.
Without this tab, the policy would only apply to new VMs created after the policy is implemented</div><style>@media(prefers-color-scheme:dark){div[style*='background: #fffbe5']{background:#322911!important;color:#f3e7be!important;border-left:7px solid #e9c46a!important}div[style*='background: #fffbe5'] strong{color:#ffe066!important}}</style></div><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Remediation.png width=1385 height=726 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Remediation_hu_f592b0bf217ba3cf.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Remediation_hu_71aeb587a4397424.png 1024w" loading=lazy alt="Remediation Step" class=gallery-image data-flex-grow=190 data-flex-basis=457px></p><p>Here you can add a message if the policy will be non-compliante</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/NonComplianceMessage.png width=1356 height=358 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/NonComplianceMessage_hu_d9ec01ec8d5c9f34.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/NonComplianceMessage_hu_edbfb61d7093e1f2.png 1024w" loading=lazy alt="Non-Compliance Message" class=gallery-image data-flex-grow=378 data-flex-basis=909px></p><p>Then in review + create tab click on <strong>Create</strong></p><div style="background:#fff5f5;border-left:7px solid #ef4444;padding:1em;margin:1em 0;border-radius:6px;color:#991b1b"><strong>🚨 Alert</strong><div style=margin-top:6px>Policy are not really fast so you need to wait 10-15 minute untill it will be applied.</div><style>@media(prefers-color-scheme:dark){div[style*='background: #fff5f5']{background:#2b1818!important;color:#fff5f5!important;border-left:7px solid #fb7185!important}div[style*='background: #fff5f5'] strong{color:#fde0e0!important}div[style*='background: #fff5f5'] img{border:1px solid #fb7185!important;border-radius:8px;margin-top:10px;margin-bottom:4px;max-width:100%}}div[style*='background: #fff5f5'] img{border:1px solid #ef4444;border-radius:8px;margin-top:10px;margin-bottom:4px;max-width:100%}</style></div><p>Inside the Compliance tab you can monitoring the policy status and the non-compliance resources or non-compliant policies.</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy4.png width=1839 height=389 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy4_hu_4c56f08cc15e98ff.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy4_hu_ecb6914fa22ed8ec.png 1024w" loading=lazy class=gallery-image data-flex-grow=472 data-flex-basis=1134px></p><p>Click on it you can see the real evidence of the policy status and the affected machine.</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy5.png width=1848 height=653 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy5_hu_7da4b670e6f578c3.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy5_hu_7bae851b790c6468.png 1024w" loading=lazy class=gallery-image data-flex-grow=283 data-flex-basis=679px></p><div style="background:#fff5f5;border-left:7px solid #ef4444;padding:1em;margin:1em 0;border-radius:6px;color:#991b1b"><strong>🚨 Alert</strong><div style=margin-top:6px><p>If the policy returns an error and is marked as non-compliant, use the Remediation Task tab to reapply the policy.</p><p><img src=/images/Policy6.png loading=lazy></p><p>Within the Remediation tab, you can monitor the progress of the remediation.</p><p><img src=/images/Policy7.png loading=lazy></p></div><style>@media(prefers-color-scheme:dark){div[style*='background: #fff5f5']{background:#2b1818!important;color:#fff5f5!important;border-left:7px solid #fb7185!important}div[style*='background: #fff5f5'] strong{color:#fde0e0!important}div[style*='background: #fff5f5'] img{border:1px solid #fb7185!important;border-radius:8px;margin-top:10px;margin-bottom:4px;max-width:100%}}div[style*='background: #fff5f5'] img{border:1px solid #ef4444;border-radius:8px;margin-top:10px;margin-bottom:4px;max-width:100%}</style></div><ol start=2><li><strong>Policy for Assigning Data Collection Rules (DCRs)</strong></li></ol><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy8.png width=1823 height=530 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy8_hu_8bf8ccf92cc018c3.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy8_hu_52459ee8bae2d442.png 1024w" loading=lazy class=gallery-image data-flex-grow=343 data-flex-basis=825px></p><p>Starting for the first one click on <em>Configure Windows Machines to be associated with a Data Collection Rule or a Data Collection Endpoint</em> and click on assign</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy9.png width=1882 height=552 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy9_hu_30227c84d88415.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy9_hu_d7785dd383fa4481.png 1024w" loading=lazy class=gallery-image data-flex-grow=340 data-flex-basis=818px></p><p>As previously done, configure the required sections.</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy10.png width=1909 height=663 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy10_hu_bd42b7b6c351d5df.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy10_hu_53a7b482d01fb05.png 1024w" loading=lazy class=gallery-image data-flex-grow=287 data-flex-basis=691px></p><p>Skip the Advanced tab</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy11.png width=1837 height=956 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy11_hu_6c85d74f87ab9a6a.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy11_hu_2e569f78162cebfb.png 1024w" loading=lazy class=gallery-image data-flex-grow=192 data-flex-basis=461px></p><p>In the Parameters tab insert the ID of the DCR created in the <strong>Step 2</strong></p><div style="background:#fff;border-left:7px solid #d1d5db;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>💡</strong><div style=margin-top:6px><p>How to find DCR ID?</p><p>Click on DCR Service and find click on JSON View</p><p><img src=/images/DCR.png loading=lazy></p><p>Click on <em>Copy</em></p><p><img src=/images/DCR2.png loading=lazy></p></div><style>div[style*='border-left: 7px'][style*=background] a{color:#2563eb!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#1d4ed8!important}@media(prefers-color-scheme:dark){div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db']{background:#232323!important;color:#eee!important;border-left:7px solid #6b7280!important}div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db'] strong{color:#eee!important}div[style*='border-left: 7px'][style*=background] a{color:#86b7fd!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#f9fafb!important}}</style></div><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy12.png width=1185 height=378 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy12_hu_b8857c7609c1c5e9.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy12_hu_cc54fa9cfbabe129.png 1024w" loading=lazy class=gallery-image data-flex-grow=313 data-flex-basis=752px></p><p>As previously use the User Assigned managed Identity created before with all the role permission</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy13.png width=1228 height=725 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy13_hu_933cdeaa1ffc2952.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy13_hu_6a6fa7fa95bc5d59.png 1024w" loading=lazy class=gallery-image data-flex-grow=169 data-flex-basis=406px></p><p>Add comment if you want and click on create policy</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy14.png width=1205 height=379 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy14_hu_8b3718214af0482a.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy14_hu_d1b971172f68b526.png 1024w" loading=lazy class=gallery-image data-flex-grow=317 data-flex-basis=763px></p><div style="background:#fff5f5;border-left:7px solid #ef4444;padding:1em;margin:1em 0;border-radius:6px;color:#991b1b"><strong>🚨 Alert</strong><div style=margin-top:6px>Policy are not really fast so you need to wait 10-15 minute untill it will be applied.</div><style>@media(prefers-color-scheme:dark){div[style*='background: #fff5f5']{background:#2b1818!important;color:#fff5f5!important;border-left:7px solid #fb7185!important}div[style*='background: #fff5f5'] strong{color:#fde0e0!important}div[style*='background: #fff5f5'] img{border:1px solid #fb7185!important;border-radius:8px;margin-top:10px;margin-bottom:4px;max-width:100%}}div[style*='background: #fff5f5'] img{border:1px solid #ef4444;border-radius:8px;margin-top:10px;margin-bottom:4px;max-width:100%}</style></div><p>Inside the Compliance tab you can monitoring the policy status and the non-compliance resources or non-compliant policies.</p><p><img src=/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy15.png width=1827 height=395 srcset="/post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy15_hu_c7bbfac27f43f4d5.png 480w, /post/microsoft/migration-from-mma-to-ama-and-dcr-configuration--azure-policy/Policy15_hu_ae345d8d9a7be9b8.png 1024w" loading=lazy class=gallery-image data-flex-grow=462 data-flex-basis=1110px></p><h3 id=conclusion>Conclusion</h3><p>In conclusion, migrating from the Microsoft Monitoring Agent (MMA) to the Azure Monitor Agent (AMA) represents a significant upgrade to your monitoring infrastructure. By creating Data Collection Rules (DCRs) and leveraging Azure Policy for automated deployment, you can streamline the process and ensure consistent and comprehensive monitoring across your environment.</p><p>The migration involves several key steps: setting up the new AMA, defining and configuring DCRs to suit your specific monitoring needs, and applying Azure Policies to automate the deployment and assignment of both the AMA and DCRs. This approach not only simplifies the transition but also enhances the efficiency and effectiveness of your monitoring setup.</p><p>By following these guidelines, you will benefit from improved performance, increased flexibility, and better support for your monitoring requirements. Ensure that you complete the migration before the deprecation of MMA to avoid any disruptions and to fully leverage the advanced features and capabilities of AMA</p><div style="background:#fff;border-left:7px solid #d1d5db;padding:1em;margin:1em 0;border-radius:6px;color:#222"><strong>💡</strong><div style=margin-top:6px><p>If you have any questions or need further assistance, feel free to contact me via <a class=link href=https://www.linkedin.com/in/roberto-d-andrea-347164183/ target=_blank rel=noopener>LinkedIn</a>.
I’m here to help with any queries you may have about the migration process.</p><p>Feel free to adjust the contact details or add any additional information as needed.</p></div><style>div[style*='border-left: 7px'][style*=background] a{color:#2563eb!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#1d4ed8!important}@media(prefers-color-scheme:dark){div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db']{background:#232323!important;color:#eee!important;border-left:7px solid #6b7280!important}div[style*='background: #fff'][style*='border-left: 7px solid #d1d5db'] strong{color:#eee!important}div[style*='border-left: 7px'][style*=background] a{color:#86b7fd!important;text-decoration:underline}div[style*='border-left: 7px'][style*=background] a:hover{color:#f9fafb!important}}</style></div></section><footer class=article-footer><section class=article-tags><a href=/tags/microsoft/>Microsoft</a>
<a href=/tags/sentinel/>Sentinel</a>
<a href=/tags/configuration/>Configuration</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under Roberto D&rsquo;Andrea</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Roberto D'Andrea</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>